import { jsx as _jsx, jsxs as _jsxs } from "react/jsx-runtime";
import { useMemo } from "react";
import { useProject } from "../state/project";
import { Link } from "react-router-dom";
import WizardNav from "../components/WizardNav";
import SmartRecommendations from "../components/SmartRecommendations";
import InteractiveCalculator from "../components/InteractiveCalculator";
import { calculatePVSystem } from "../utils/calculations";
import { usePvCalculations } from "../utils/pvCalculations";
import { formatGermanNumber, formatGermanCurrency, formatGermanInteger, formatGermanKWh, formatGermanKWp, formatGermanPercent } from "../utils/germanFormat";
// Minimal Kpi component for displaying KPIs
function Kpi({ label, value }) {
    return (_jsxs("div", { className: "bg-white rounded-lg p-4 text-center border", children: [_jsx("div", { className: "text-lg font-bold", children: value }), _jsx("div", { className: "text-xs text-slate-600", children: label })] }));
}
export default function Results() {
    const { state } = useProject();
    const { mode, customer: c, building, consumption, options } = state;
    const { input, results } = usePvCalculations();
    // Erweiterte Live-Berechnungen basierend auf den echten eingegebenen Daten
    const calculations = useMemo(() => {
        // Berechnungsparameter aus echten Formulardaten zusammenstellen
        const params = {
            // System-Parameter aus Building Data
            systemSize: building.roofArea ? Math.min(building.roofArea * 0.15, 20) : 10, // kWp basierend auf Dachfläche
            modulePower: 440, // Wp
            orientation: building.roofOrientation || "Süd",
            tilt: building.roofTilt || 30,
            location: c.bundesland || "Deutschland",
            // Verbrauchsdaten aus Consumption Analysis
            annualConsumption: consumption.annualKWhHousehold || 4000, // kWh
            daytimeConsumption: consumption.homeOfficeHours ?
                Math.min(0.6, 0.3 + (consumption.homeOfficeHours / 8) * 0.3) : 0.4,
            // Speicher aus Options
            hasBattery: options.battery_interest || false,
            batterySize: options.battery_size_preference === "small" ? 5 :
                options.battery_size_preference === "medium" ? 10 :
                    options.battery_size_preference === "large" ? 15 :
                        options.battery_size_preference === "very_large" ? 20 : 10,
            // Wärmepumpe aus Options
            hasHeatPump: options.hp_interest || false,
            heatingDemand: consumption.annualKWhHeating || 0,
            // Wirtschaftliche Parameter
            electricityPrice: 0.35,
            feedInTariff: 0.08
        };
        return calculatePVSystem(params);
    }, [c.bundesland, building, consumption, options]);
    return (_jsxs("div", { className: "space-y-6", children: [_jsxs("div", { className: "mb-8", children: [_jsx("h1", { className: "text-3xl font-bold text-slate-800 mb-2", children: "\uD83D\uDCCA Projektergebnisse" }), _jsx("p", { className: "text-slate-600", children: "Detaillierte Kalkulation basierend auf Ihren Eingaben" })] }), _jsxs("section", { className: "rounded-xl bg-gradient-to-r from-blue-50 to-green-50 border border-blue-200 p-6 shadow", children: [_jsx("h2", { className: "text-xl font-semibold text-blue-800 mb-4", children: "\u26A1 System-\u00DCbersicht" }), _jsxs("div", { className: "grid md:grid-cols-2 lg:grid-cols-4 gap-4", children: [_jsxs("div", { className: "bg-white rounded-lg p-4 text-center border", children: [_jsx("div", { className: "text-2xl font-bold text-blue-600", children: formatGermanKWp(calculations.finalSystemSize) }), _jsx("div", { className: "text-sm text-slate-600", children: "Anlagengr\u00F6\u00DFe" })] }), _jsxs("div", { className: "bg-white rounded-lg p-4 text-center border", children: [_jsx("div", { className: "text-2xl font-bold text-green-600", children: formatGermanInteger(calculations.moduleCount) }), _jsx("div", { className: "text-sm text-slate-600", children: "Module (440Wp)" })] }), _jsxs("div", { className: "bg-white rounded-lg p-4 text-center border", children: [_jsx("div", { className: "text-2xl font-bold text-orange-600", children: formatGermanPercent(calculations.roofUtilization) }), _jsx("div", { className: "text-sm text-slate-600", children: "Dachnutzung" })] }), _jsxs("div", { className: "bg-white rounded-lg p-4 text-center border", children: [_jsx("div", { className: "text-2xl font-bold text-purple-600", children: formatGermanCurrency(calculations.systemCost, 0) }), _jsx("div", { className: "text-sm text-slate-600", children: "Investition" })] })] })] }), _jsxs("section", { className: "rounded-xl bg-white p-6 shadow border", children: [_jsx("h2", { className: "text-xl font-semibold mb-4", children: "\uD83D\uDCC8 Energieertr\u00E4ge" }), _jsxs("div", { className: "grid md:grid-cols-3 gap-4 mb-4", children: [_jsxs("div", { className: "bg-green-50 rounded-lg p-4 text-center border border-green-200", children: [_jsx("div", { className: "text-2xl font-bold text-green-600", children: formatGermanKWh(calculations.annualYield) }), _jsx("div", { className: "text-sm text-slate-600", children: "pro Jahr" })] }), _jsxs("div", { className: "bg-blue-50 rounded-lg p-4 text-center border border-blue-200", children: [_jsx("div", { className: "text-2xl font-bold text-blue-600", children: formatGermanKWh(calculations.monthlyYield) }), _jsx("div", { className: "text-sm text-slate-600", children: "pro Monat" })] }), _jsxs("div", { className: "bg-orange-50 rounded-lg p-4 text-center border border-orange-200", children: [_jsx("div", { className: "text-2xl font-bold text-orange-600", children: formatGermanKWh(calculations.dailyYield) }), _jsx("div", { className: "text-sm text-slate-600", children: "pro Tag" })] })] }), _jsx("div", { className: "space-y-8", children: _jsxs("section", { className: "bg-white rounded-lg shadow p-6", children: [_jsx("h2", { className: "text-xl font-semibold mb-4", children: "Erweiterte Wirtschaftlichkeits-Kennzahlen" }), _jsxs("div", { className: "grid md:grid-cols-3 gap-4", children: [_jsx(Kpi, { label: "Autarkiegrad", value: formatGermanPercent(results.autarkiegrad_prozent ?? 0) }), _jsx(Kpi, { label: "J\u00E4hrliche Ersparnis", value: formatGermanCurrency(results.jahres_ersparnis_eur ?? 0) }), _jsx(Kpi, { label: "Break-Even (Jahr)", value: results.break_even_jahr ?? "—" }), _jsx(Kpi, { label: "PV-Strompreis", value: formatGermanNumber(results.pv_strompreis_ct_kwh ?? 0, 2) + " ct/kWh" }), _jsx(Kpi, { label: "Speichergrad", value: formatGermanPercent(results.speichergrad_prozent ?? 0) }), _jsx(Kpi, { label: "Notstrom Kapazit\u00E4t / Tag", value: formatGermanNumber(results.notstrom_kapazitaet_kwh_tag ?? 0, 2) + " kWh" }), _jsx(Kpi, { label: "Restwert nach Laufzeit", value: formatGermanCurrency(results.restwert_nach_laufzeit_eur ?? 0) }), _jsx(Kpi, { label: "Inflationsbereinigter Wert (20J)", value: formatGermanCurrency(results.inflationsbereinigter_wert_20a_eur ?? 0) }), _jsx(Kpi, { label: "Lineare AfA / Jahr", value: formatGermanCurrency(results.afa_linear_jahr_eur ?? 0) })] })] }) }), ");", _jsxs("div", { className: "grid md:grid-cols-2 gap-4", children: [_jsxs("div", { className: "space-y-3", children: [_jsx("h4", { className: "font-medium text-slate-700", children: "\uD83C\uDFE0 Eigenverbrauch" }), _jsxs("div", { className: "flex justify-between", children: [_jsx("span", { children: "Direkt verbraucht:" }), _jsxs("span", { className: "font-medium", children: [calculations.breakdown.directConsumption.toLocaleString('de-DE'), " kWh"] })] }), _jsxs("div", { className: "flex justify-between", children: [_jsx("span", { children: "Aus Speicher:" }), _jsxs("span", { className: "font-medium", children: [calculations.breakdown.fromBattery.toLocaleString('de-DE'), " kWh"] })] }), _jsxs("div", { className: "flex justify-between font-semibold border-t pt-2", children: [_jsxs("span", { children: ["Gesamt (", calculations.selfConsumptionRate.toFixed(1), "%):"] }), _jsxs("span", { children: [calculations.selfConsumption.toLocaleString('de-DE'), " kWh"] })] })] }), _jsxs("div", { className: "space-y-3", children: [_jsx("h4", { className: "font-medium text-slate-700", children: "\uD83C\uDF10 Netzinteraktion" }), _jsxs("div", { className: "flex justify-between", children: [_jsx("span", { children: "Einspeisung:" }), _jsxs("span", { className: "font-medium", children: [calculations.feedIn.toLocaleString('de-DE'), " kWh"] })] }), _jsxs("div", { className: "flex justify-between", children: [_jsx("span", { children: "Netzbezug:" }), _jsxs("span", { className: "font-medium", children: [calculations.breakdown.fromGrid.toLocaleString('de-DE'), " kWh"] })] }), _jsxs("div", { className: "flex justify-between font-semibold border-t pt-2", children: [_jsx("span", { children: "Autarkie:" }), _jsxs("span", { children: [calculations.autarkyRate?.toFixed(1), "%"] })] })] })] })] }), _jsxs("section", { className: "rounded-xl bg-gradient-to-r from-green-50 to-yellow-50 border border-green-200 p-6 shadow", children: [_jsx("h2", { className: "text-xl font-semibold text-green-800 mb-4", children: "\uD83D\uDCB0 Wirtschaftlichkeit" }), _jsxs("div", { className: "grid md:grid-cols-2 lg:grid-cols-4 gap-4", children: [_jsxs("div", { className: "bg-white rounded-lg p-4 text-center border", children: [_jsxs("div", { className: "text-2xl font-bold text-green-600", children: [calculations.annualSavings.toLocaleString('de-DE'), " \u20AC"] }), _jsx("div", { className: "text-sm text-slate-600", children: "Ersparnis/Jahr" })] }), _jsxs("div", { className: "bg-white rounded-lg p-4 text-center border", children: [_jsx("div", { className: "text-2xl font-bold text-blue-600", children: calculations.paybackTime.toFixed(1) }), _jsx("div", { className: "text-sm text-slate-600", children: "Jahre Amortisation" })] }), _jsxs("div", { className: "bg-white rounded-lg p-4 text-center border", children: [_jsxs("div", { className: "text-2xl font-bold text-purple-600", children: [calculations.roi20Years.toLocaleString('de-DE'), " \u20AC"] }), _jsx("div", { className: "text-sm text-slate-600", children: "Gewinn 20 Jahre" })] }), _jsxs("div", { className: "bg-white rounded-lg p-4 text-center border", children: [_jsxs("div", { className: "text-2xl font-bold text-orange-600", children: [(calculations.roi20Years / calculations.systemCost * 100).toFixed(0), "%"] }), _jsx("div", { className: "text-sm text-slate-600", children: "ROI 20 Jahre" })] })] })] }), _jsxs("section", { className: "rounded-xl bg-gradient-to-r from-green-50 to-teal-50 border border-green-200 p-6 shadow", children: [_jsx("h2", { className: "text-xl font-semibold text-green-800 mb-4", children: "\uD83C\uDF31 Umweltbeitrag" }), _jsxs("div", { className: "grid md:grid-cols-2 gap-4", children: [_jsxs("div", { className: "bg-white rounded-lg p-4 text-center border", children: [_jsxs("div", { className: "text-2xl font-bold text-green-600", children: [calculations.co2SavingsAnnual.toLocaleString('de-DE'), " kg"] }), _jsx("div", { className: "text-sm text-slate-600", children: "CO\u2082-Einsparung/Jahr" })] }), _jsxs("div", { className: "bg-white rounded-lg p-4 text-center border", children: [_jsxs("div", { className: "text-2xl font-bold text-teal-600", children: [(calculations.co2Savings20Years / 1000).toFixed(1), " t"] }), _jsx("div", { className: "text-sm text-slate-600", children: "CO\u2082-Einsparung 20 Jahre" })] })] }), _jsx("div", { className: "mt-4 text-center", children: _jsxs("p", { className: "text-sm text-slate-600", children: ["Das entspricht ca. ", _jsxs("strong", { children: [Math.round(calculations.co2SavingsAnnual / 2300), " B\u00E4umen"] }), " pro Jahr oder ", _jsxs("strong", { children: [Math.round(calculations.co2SavingsAnnual / 140), " weniger Autokilometern"] })] }) })] }), _jsx(SmartRecommendations, { data: {
                    totalConsumption: consumption.annualKWhHousehold || 0,
                    electricityPrice: 0.35,
                    potentialSavings: calculations.annualSavings,
                    futureConsumption: (consumption.annualKWhHousehold || 0) * 1.02,
                    hasSignificantIncrease: (consumption.annualKWhHousehold || 0) > 5000,
                    consumptionCategory: consumption.annualKWhHousehold && consumption.annualKWhHousehold > 5000 ? 'hoch' :
                        consumption.annualKWhHousehold && consumption.annualKWhHousehold < 3000 ? 'niedrig' : 'mittel'
                }, buildingData: {
                    roofArea: building.roofArea,
                    roofOrientation: building.roofOrientation,
                    roofTilt: building.roofTilt
                } }), _jsx(InteractiveCalculator, { initialSystemSize: calculations.finalSystemSize, annualConsumption: consumption.annualKWhHousehold || 4000, roofArea: building.roofArea }), _jsxs("section", { className: "rounded-xl bg-white p-6 shadow border", children: [_jsx("h2", { className: "text-xl font-semibold mb-4", children: "\uD83C\uDFD7\uFE0F Projektbasis" }), _jsxs("div", { className: "grid md:grid-cols-2 lg:grid-cols-4 gap-4 text-sm", children: [_jsxs("div", { className: "space-y-1", children: [_jsx("span", { className: "text-slate-500 block", children: "Anlagenmodus:" }), _jsx("span", { className: "font-medium", children: mode === "pv" ? "☀️ Photovoltaik" : mode === "hp" ? "🔥 Wärmepumpe" : mode === "both" ? "⚡ PV + Wärmepumpe" : "—" })] }), _jsxs("div", { className: "space-y-1", children: [_jsx("span", { className: "text-slate-500 block", children: "Anlagentyp:" }), _jsx("span", { className: "font-medium", children: c.anlagentyp })] }), _jsxs("div", { className: "space-y-1", children: [_jsx("span", { className: "text-slate-500 block", children: "Einspeisetyp:" }), _jsx("span", { className: "font-medium", children: c.einspeisetyp })] }), _jsxs("div", { className: "space-y-1", children: [_jsx("span", { className: "text-slate-500 block", children: "Kundentyp:" }), _jsx("span", { className: "font-medium", children: c.kundentyp })] })] })] }), _jsxs("section", { className: "rounded-xl bg-white p-6 shadow border", children: [_jsx("h2", { className: "text-xl font-semibold mb-4", children: "\uD83D\uDC64 Kundendaten" }), _jsxs("div", { className: "grid md:grid-cols-2 gap-4 text-sm", children: [_jsxs("div", { className: "space-y-2", children: [_jsxs("div", { children: [_jsx("span", { className: "text-slate-500", children: "Name:" }), " ", _jsx("span", { className: "font-medium", children: `${c.titel ? c.titel + " " : ""}${c.anrede ? c.anrede + " " : ""}${c.vorname} ${c.nachname}`.trim() })] }), _jsxs("div", { children: [_jsx("span", { className: "text-slate-500", children: "E-Mail:" }), " ", _jsx("span", { className: "font-medium", children: c.email || "—" })] }), _jsxs("div", { children: [_jsx("span", { className: "text-slate-500", children: "Telefon (Festnetz):" }), " ", _jsx("span", { className: "font-medium", children: c.telFest || "—" })] }), _jsxs("div", { children: [_jsx("span", { className: "text-slate-500", children: "Telefon (Mobil):" }), " ", _jsx("span", { className: "font-medium", children: c.telMobil || "—" })] })] }), _jsxs("div", { className: "space-y-2", children: [_jsxs("div", { children: [_jsx("span", { className: "text-slate-500", children: "Stra\u00DFe:" }), " ", _jsxs("span", { className: "font-medium", children: [c.strasse, " ", c.hausnummer] })] }), _jsxs("div", { children: [_jsx("span", { className: "text-slate-500", children: "Ort:" }), " ", _jsxs("span", { className: "font-medium", children: [c.plz, " ", c.ort] })] }), _jsxs("div", { children: [_jsx("span", { className: "text-slate-500", children: "Bundesland:" }), " ", _jsx("span", { className: "font-medium", children: c.bundesland || "—" })] }), c.anmerkung && _jsxs("div", { children: [_jsx("span", { className: "text-slate-500", children: "Anmerkung:" }), " ", _jsx("span", { className: "font-medium", children: c.anmerkung })] })] })] })] }), _jsxs("section", { className: "rounded-xl bg-slate-50 border p-6", children: [_jsx("h2", { className: "text-xl font-semibold mb-4", children: "\uD83D\uDE80 N\u00E4chste Schritte" }), _jsxs("div", { className: "grid md:grid-cols-3 gap-4", children: [_jsxs(Link, { to: "/pdf", className: "bg-purple-500 hover:bg-purple-600 text-white p-4 rounded-lg text-center transition-colors", children: [_jsx("div", { className: "text-xl mb-2", children: "\uD83D\uDCC4" }), _jsx("div", { className: "font-medium", children: "PDF generieren" }), _jsx("div", { className: "text-sm opacity-90", children: "Angebot erstellen" })] }), _jsxs(Link, { to: "/solar", className: "bg-green-500 hover:bg-green-600 text-white p-4 rounded-lg text-center transition-colors", children: [_jsx("div", { className: "text-xl mb-2", children: "\u2600\uFE0F" }), _jsx("div", { className: "font-medium", children: "Detailkalkulation" }), _jsx("div", { className: "text-sm opacity-90", children: "Solar-Rechner" })] }), _jsxs(Link, { to: "/crm", className: "bg-blue-500 hover:bg-blue-600 text-white p-4 rounded-lg text-center transition-colors", children: [_jsx("div", { className: "text-xl mb-2", children: "\uD83D\uDC65" }), _jsx("div", { className: "font-medium", children: "Kunde speichern" }), _jsx("div", { className: "text-sm opacity-90", children: "CRM-System" })] })] })] }), _jsx(WizardNav, { backTo: "/project/options", nextTo: undefined, showHome: true })] }));
}
